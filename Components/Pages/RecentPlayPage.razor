@page "/recent"
@using Singularity.Audio
@using System.Collections.Specialized
@inject IJSRuntime Runtime
@inject YoutubeClient Youtube
@inject AudioManager AudioManager
@inject NavigationManager Nav

<TabbedPageView Title="Queue">
    @foreach (var song in AudioManager.Queue.Songs)
    {
        <MusicTrack Song="@song"></MusicTrack>
    }
</TabbedPageView>

@code
{
    private const string SearchUrl = "https://clients1.google.com/complete/search?client=youtube&gs_ri=youtube&ds=yt&q=";
    private HttpClient Http = new HttpClient();
    private string search;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        AudioManager.Queue.Songs.CollectionChanged += SongListChanged;
    }

    private async Task<IEnumerable<string>> SearchSuggestions(string value, CancellationToken token)
    {
        value = Uri.EscapeDataString(value);
        value = SearchUrl + value;
        var res = await Http.GetAsync(value, token);
        var js = await res.Content.ReadAsStringAsync(token);

        var parts = js.Split('[').Where(t => t.Split('"').Length > 2).Select(t => t.Split('"')[1]);

        return parts.Distinct().ToList();
    }

    private void SongListChanged(object? sender, NotifyCollectionChangedEventArgs e)
    {
        StateHasChanged();
    }
}


<style>
    .tracks {
        padding: 30px;
        height: calc(100vh - 250px);
        overflow-y: auto;
    }

    .playlist-text {
        color: white;
        font-size: 23px;
        display: flex;
        margin-left: 30px;
    }
</style>

